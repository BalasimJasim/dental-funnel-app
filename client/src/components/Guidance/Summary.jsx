import PropTypes from "prop-types";
import styles from "./Summary.module.css";

const TREATMENTS = {
  pain: "Термінова допомога при болю",
  missing: "Протезування зубів",
  aesthetic: "Естетична стоматологія",
  alignment: "Ортодонтія",
  prevention: "Профілактичний огляд",
};

const TREATMENT_RECOMMENDATIONS = {
  // Single missing tooth paths
  recent_loss: {
    title: "Негайна імплантація",
    description:
      "Сучасний протокол імплантації з можливістю встановлення тимчасової коронки в день операції.",
    benefits: [
      "Збереження об'єму кісткової тканини та ясен",
      "Можливість отримати естетичну тимчасову коронку одразу",
      "Менша кількість хірургічних втручань",
      "Швидша реабілітація",
    ],
    timeline: "Операція можлива протягом 24-48 годин після видалення",
    steps: [
      "КТ-діагностика та планування імплантації",
      "Професійна гігієна порожнини рота",
      "Встановлення імпланта та тимчасової коронки",
      "Контрольний огляд через тиждень",
      "Встановлення постійної коронки через 3-4 місяці",
    ],
  },

  months_ago: {
    title: "Класична імплантація",
    description:
      "Двоетапний протокол імплантації з формуванням ясенного контуру.",
    benefits: [
      "Передбачуваний результат",
      "Можливість корекції ясенного контуру",
      "Оптимальне загоєння кістки",
      "Довготривалий естетичний результат",
    ],
    timeline: "Загальний термін лікування 4-5 місяців",
    steps: [
      "КТ-діагностика та планування",
      "Професійна гігієна",
      "Встановлення імпланта",
      "Розкриття імпланта через 3 місяці",
      "Формування ясенного контуру",
      "Встановлення постійної коронки",
    ],
  },

  years_ago: {
    title: "Імплантація з кістковою пластикою",
    description:
      "Комплексне відновлення втраченої кісткової тканини з подальшою імплантацією.",
    benefits: [
      "Відновлення втраченого об'єму кістки",
      "Можливість встановлення імпланта оптимального розміру",
      "Покращення естетики ясен",
      "Довготривала стабільність результату",
    ],
    timeline: "Загальний термін лікування 8-10 місяців",
    steps: [
      "КТ-діагностика та планування",
      "Професійна гігієна",
      "Кісткова пластика",
      "Контрольні огляди протягом 4-6 місяців",
      "Встановлення імпланта",
      "Формування ясенного контуру",
      "Протезування",
    ],
  },

  // Multiple missing teeth paths
  front_teeth: {
    title: "Естетична реабілітація фронтальної зони",
    description:
      "Комплексне відновлення передніх зубів з індивідуальним підходом до естетики.",
    benefits: [
      "Природна естетика посмішки",
      "Індивідуальний дизайн посмішки",
      "Відновлення правильного прикусу",
      "Гармонійний профіль обличчя",
    ],
    timeline: "Лікування триває 4-6 місяців",
    steps: [
      "Фотопротокол та планування дизайну посмішки",
      "Професійна гігієна",
      "Виготовлення хірургічного шаблону",
      "Встановлення імплантів",
      "Тимчасове протезування",
      "Формування ясенної естетики",
      "Встановлення постійних коронок",
    ],
  },

  back_teeth: {
    title: "Відновлення жувальної функції",
    description:
      "Надійне відновлення жувальних зубів для комфортного харчування.",
    benefits: [
      "Повноцінне жування",
      "Запобігання зміщенню зубів",
      "Розподіл жувального навантаження",
      "Профілактика проблем СНЩС",
    ],
    timeline: "Лікування триває 3-5 місяців",
    steps: [
      "Діагностика та планування навантаження",
      "Встановлення імплантів",
      "Протезування з урахуванням прикусу",
    ],
  },

  // Aesthetic concerns
  color: {
    title: "Професійне відбілювання та вініри",
    description:
      "Комплексне покращення кольору зубів з довготривалим результатом.",
    benefits: [
      "Яскрава природна посмішка",
      "Безпечна процедура",
      "Індивідуальний підбір відтінку",
      "Збереження структури зубів",
    ],
    timeline: "Результат за 1-2 відвідування",
    steps: [
      "Професійна гігієна",
      "Відбілювання зубів",
      "Встановлення вінірів за потреби",
    ],
  },

  shape: {
    title: "Естетична реставрація",
    description: "Корекція форми зубів за допомогою сучасних матеріалів.",
    benefits: [
      "Природний вигляд",
      "Мінімальне втручання",
      "Можливість корекції",
      "Швидкий результат",
    ],
    timeline: "1-3 відвідування",
    steps: [
      "Дизайн посмішки",
      "Виготовлення макету",
      "Встановлення вінірів або реставрація",
    ],
  },

  // Pain/Emergency
  acute_pain: {
    title: "Невідкладна допомога",
    description: "Термінове усунення болю та вирішення проблеми.",
    benefits: [
      "Швидке знеболення",
      "Точна діагностика",
      "Усунення причини болю",
      "Запобігання ускладненням",
    ],
    timeline: "Прийом в день звернення",
    steps: ["Невідкладна діагностика", "Знеболення", "Лікування причини болю"],
  },

  // Complete tooth loss / All-on-X
  fixed_solution: {
    title: "All-on-X Імплантація",
    description:
      "Повна реконструкція щелепи з опорою на 4-6 імплантів з негайним навантаженням.",
    benefits: [
      "Фіксована конструкція без знімної частини",
      "Відновлення всіх зубів за 1-2 дні",
      "Природний вигляд та комфортне користування",
      "Профілактика атрофії кісткової тканини",
    ],
    timeline: "Основний етап 2-3 дні, повне завершення через 4-6 місяців",
    steps: [
      "КТ-діагностика та 3D планування операції",
      "Виготовлення хірургічного шаблону",
      "Професійна гігієна та підготовка до операції",
      "Видалення зубів (за потреби)",
      "Встановлення імплантів за хірургічним шаблоном",
      "Фіксація тимчасового протезу протягом 24 годин",
      "Контрольні огляди та корекції",
      "Виготовлення постійного протезу через 4-6 місяців",
    ],
  },

  mixed: {
    title: "Комплексна імплантація",
    description:
      "Відновлення зубів у різних ділянках з індивідуальним підходом до кожної зони.",
    benefits: [
      "Комплексне вирішення проблеми",
      "Оптимальне планування навантаження",
      "Поетапне відновлення за пріоритетами",
      "Довготривалий прогнозований результат",
    ],
    timeline: "Поетапне лікування 4-8 місяців",
    steps: [
      "КТ-діагностика всієї щелепи",
      "3D планування розташування імплантів",
      "Виготовлення хірургічного шаблону",
      "Професійна гігієна",
      "Встановлення імплантів за планом",
      "Тимчасове протезування",
      "Формування ясенної архітектури",
      "Постійне протезування",
    ],
  },

  // Update existing recommendations to include CT where needed
  front_teeth: {
    // ... existing properties ...
    steps: [
      "КТ-діагностика та 3D планування імплантації",
      "Виготовлення хірургічного шаблону",
      "Професійна гігієна",
      "Встановлення імплантів за шаблоном",
      "Тимчасове протезування",
      "Формування ясенної естетики",
      "Встановлення постійних коронок",
    ],
  },

  back_teeth: {
    // ... existing properties ...
    steps: [
      "КТ-діагностика та оцінка висоти кістки",
      "3D планування розташування імплантів",
      "Виготовлення хірургічного шаблону",
      "Професійна гігієна",
      "Встановлення імплантів",
      "Протезування з урахуванням прикусу",
    ],
  },
};

const Summary = ({ answers, onConfirm, onBack }) => {
  // Define default recommendation
  const defaultRecommendation = {
    title: "Персональна Консультація",
    description:
      "Комплексний огляд та складання індивідуального плану лікування.",
    benefits: [
      "Детальна діагностика",
      "Індивідуальний план лікування",
      "Обговорення всіх варіантів",
      "Розрахунок вартості",
    ],
    timeline: "Консультація та планування протягом тижня",
    steps: [
      "Детальна діагностика",
      "Консультація зі спеціалістом",
      "Складання плану лікування",
    ],
  };

  // Get the recommendation based on answers
  const getRecommendation = () => {
    const lastAnswer = answers[Object.keys(answers).length];
    const firstAnswer = answers[1]; // First step answer

    // Get specific recommendation based on the path
    const recommendation = TREATMENT_RECOMMENDATIONS[lastAnswer];

    if (recommendation) {
      return {
        ...recommendation,
        timeline: recommendation.timeline || defaultRecommendation.timeline,
        steps: recommendation.steps || defaultRecommendation.steps,
      };
    }

    return defaultRecommendation;
  };

  const recommendation = getRecommendation();

  return (
    <div className={styles.container}>
      <div className={styles.summaryCard}>
        <button onClick={onBack} className={styles.backButton}>
          ← Попереднє питання
        </button>

        <h1 className={styles.title}>Ваш Персональний План Лікування</h1>

        <div className={styles.recommendation}>
          <h2>{recommendation?.title}</h2>
          <p className={styles.description}>{recommendation?.description}</p>

          {recommendation?.benefits && (
            <div className={styles.benefits}>
              <h3>Переваги обраного рішення:</h3>
              <ul>
                {recommendation.benefits.map((benefit, index) => (
                  <li key={index}>{benefit}</li>
                ))}
              </ul>
            </div>
          )}

          {recommendation?.timeline && (
            <div className={styles.timeline}>
              <h3>Терміни лікування</h3>
              <p>{recommendation.timeline}</p>
            </div>
          )}

          {recommendation?.steps && (
            <div className={styles.nextSteps}>
              <h3>План лікування:</h3>
              <ol>
                {recommendation.steps.map((step, index) => (
                  <li key={index}>{step}</li>
                ))}
              </ol>
            </div>
          )}
        </div>

        <button onClick={onConfirm} className={styles.confirmButton}>
          Записатися на консультацію
        </button>
      </div>
    </div>
  );
};

Summary.propTypes = {
  answers: PropTypes.objectOf(PropTypes.string).isRequired,
  onConfirm: PropTypes.func.isRequired,
  onBack: PropTypes.func.isRequired,
};

export default Summary;
